<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select a Seat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .seats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }
        .seat {
            width: 50px;
            height: 50px;
            background-color: lightblue;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        .seat.booked {
            background-color: gray;
            cursor: not-allowed;
        }
        .seat.selected {
            background-color: blue;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Select a Seat</h1>
    <div class="seats" id="seats"></div>
    <button onclick="confirmSelection()">Confirm Selection</button>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetch('/available-seats')
                .then(response => response.json())
                .then(data => {
                    const seatsContainer = document.getElementById('seats');
                    data.forEach(seat => {
                        const seatElement = document.createElement('div');
                        seatElement.className = 'seat';
                        seatElement.textContent = seat.name;
                        if (seat.booked) {
                            seatElement.classList.add('booked');
                        } else {
                            seatElement.addEventListener('click', () => selectSeat(seat.name));
                        }
                        seatsContainer.appendChild(seatElement);
                    });
                });
        });

        let selectedSeat = null;

        function selectSeat(seat) {
            if (selectedSeat) {
                document.querySelector(`.seat.selected`).classList.remove('selected');
            }
            selectedSeat = seat;
            document.querySelector(`.seat:contains(${seat})`).classList.add('selected');
        }

        function confirmSelection() {
            const urlParams = new URLSearchParams(window.location.search);
            const airline = urlParams.get('airline');
            const flightNumber = urlParams.get('flight_number');
            const departureTime = urlParams.get('departure_time');
            const arrivalTime = urlParams.get('arrival_time');
            const price = urlParams.get('price');
            const departure = urlParams.get('departure');
            const arrival = urlParams.get('arrival');
            const gate = urlParams.get('gate');

            if (selectedSeat) {
                const url = `/booking.html?seat=${selectedSeat}&airline=${airline}&flight_number=${flightNumber}&departure_time=${departureTime}&arrival_time=${arrivalTime}&price=${price}&departure=${departure}&arrival=${arrival}&gate=${gate}`;
                window.location.href = url;
            } else {
                alert('Please select a seat.');
            }
        }
    </script>
</body>
</html>
